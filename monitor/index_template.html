<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml" lang="en">
<head>
    <meta name="robots" content="index" />
    <meta name="robots" content="follow" />
    <meta name="language" content="English" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="pragma" content="no-cache" />

    <title>Fixed Network Equipment Monitoring Server</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script type="text/javascript">
        var sock = null;
        var ellog = null;

        window.onload = function () {
            var wsuri = "ws://<<<system_name>>>:9000";

            // implement poor-mans jQuery
            var $ = function (selector) {
                return document.querySelector(selector);
            };

            var previousCmdType = '';

            function testCommandFormFields() {
                var cmd_type = $('#cmd_type').selectedOptions[0];
                var cmd_confirm = $('#cmd_confirm');
                var argument = $('#cmd_arg');
                var cmd_slot_no = $('#cmd_slot_no');
                var cmd_mot_mfid = $('#cmd_mot_mfid');
                var cmd_send_btn = $('#cmd_send_btn');

                // reset form when we switch our command type
                if (previousCmdType != cmd_type.value) {
                    argument.value = 1;
                    cmd_confirm.checked = false;
                    cmd_mot_mfid.checked = false;
                }

                previousCmdType = cmd_type.value;

                // should we be displaying the DMR slot selection?
                if (cmd_type.value.startsWith('dmr')) {
                    cmd_slot_no.disabled = false;
                    cmd_slot_no.style.display = 'inline-block';
                    cmd_mot_mfid.disabled = true;
                } else {
                    cmd_slot_no.disabled = true;
                    cmd_slot_no.style.display = 'none';
                    cmd_mot_mfid.disabled = false;
                }

                // should we disable the argument field for this command type?
                if ((cmd_type.value === 'p25-cc') || (cmd_type.value === 'dmr-beacon')) {
                    argument.disabled = true;

                    // hide slot selection for this
                    cmd_slot_no.disabled = true;
                    cmd_slot_no.style.display = 'none';

                    cmd_mot_mfid.disabled = true;
                } else {
                    argument.disabled = false;
                }

                // do we require confirmation to enter and transmit this command type?
                if ((cmd_type.value === 'p25-rid-inhibit') || (cmd_type.value === 'p25-rid-uninhibit') ||
                    (cmd_type.value === 'dmr-rid-inhibit') || (cmd_type.value === 'dmr-rid-uninhibit')) {
                    cmd_confirm.style.display = 'inline-block';
                    if (cmd_confirm.checked === false) {
                        argument.disabled = true;
                        cmd_send_btn.disabled = true;
                    } else {
                        argument.disabled = false;
                        cmd_send_btn.disabled = false;
                    }
                } else {
                    cmd_confirm.style.display = 'none';
                    cmd_send_btn.disabled = false;
                }
            }

            function transmitCommand() {
                var cmd_peer_id = $('#cmd_peer_id').selectedOptions[0];
                var cmd_type = $('#cmd_type').selectedOptions[0];
                var cmd_slot_no = $('#cmd_slot_no').selectedOptions[0];
                var cmd_mot_mfid = $('#cmd_mot_mfid');

                var argument = $('#cmd_arg');
                var arg_val = argument.value;
                if (argument.disabled === true) {
                    arg_val = 0; // force to 0
                }

                var dmr_slot_no = cmd_slot_no.value;
                if (!cmd_type.value.startsWith('dmr')) {
                    dmr_slot_no = 0; // force to 0
                }

                if (sock) {
                    sock.send('m' + cmd_peer_id.value + ',' + cmd_type.value + ',' + arg_val + ',' + dmr_slot_no + ',' + cmd_mot_mfid.checked);
                }
            }

            var ellog = $('#log');
            function log(_msg) {
                ellog.innerHTML += _msg + '\n';
                ellog.scrollTop = ellog.scrollHeight;
            }

            var cmd_panel = $('#cmdpanel');
            var hblink_table = $('#hblink');
            var rules_table = $('#rules');
            var grp_affil_table = $('#grpaffil');

            var activity_table = $('#activity');
            
            if ("WebSocket" in window) {
                sock = new WebSocket(wsuri);
            } else if ("MozWebSocket" in window) {
                sock = new MozWebSocket(wsuri);
            } else {
                log("Browser does not support WebSocket!");
            }

            if (sock) {
                sock.onopen = function () {
                    log("Connected to " + wsuri);
                };

                sock.onclose = function (e) {
                    log("Connection closed (wasClean = " + e.wasClean + ", code = " + e.code + ", reason = '" + e.reason + "')");
                    hblink_table.innerHTML = "";
                    rules_table.innerHTML = "";
                    grp_affil_table.innerHTML = "";
                    sock = null;
                };

                sock.onmessage = function (e) {
                    var opcode = e.data.slice(0, 1);
                    var message = e.data.slice(1);
                    if (opcode === "d") {
                        hblink_table.innerHTML = message;
                    } else if (opcode === "b") {
                        rules_table.innerHTML = message;
                    } else if (opcode === "l") {
                        log(message);
                    } else if (opcode === "c") {
                        activity_table.innerHTML = "";
                    } else if (opcode === "a") {
                        activity_table.innerHTML += message;
                    } else if (opcode === "g") {
                        grp_affil_table.innerHTML = message;
                    } else if (opcode === "q") {
                        log(message);
                        cmd_panel.innerHTML = "";
                        hblink_table.innerHTML = "";
                        rules_table.innerHTML = "";
                        grp_affil_table.innerHTML = "";
                    } else if (opcode === "m") {
                        if (cmd_panel.innerHTML === '') {
                            cmd_panel.innerHTML = message;

                            var cmd_type_select = $('#cmd_type');
                            cmd_type_select.addEventListener('input', testCommandFormFields, false);
                            var cmd_confirm = $('#cmd_confirm');
                            cmd_confirm.addEventListener('input', testCommandFormFields, false);
                            var cmd_send_btn = $('#cmd_send_btn');
                            cmd_send_btn.addEventListener('click', transmitCommand, false);
                            testCommandFormFields();
                        }
                    } else {
                        log("Unknown Message Received: " + message);
                    }
                };
            }
        };
    </script>
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="font-size: 8px; text-align: left; padding-left: 8px; float: left;">Hostname: <<<system_name>>></div>
            <h1>Fixed Network Equipment Monitoring Server</h1>
        </div>
        <div class="contentwide">
            <div id="cmdpanel"></div>
            <div>
                <h3>Network Traffic Trace</h3>
                <pre id="log" style="height: 24em; overflow-y: scroll; border: 2px solid #242d31; background-color: #d0d0d0; text-align: left;"></pre>
            </div>
            <div id="grpaffil"></div>
            <div>
                <h3>System Activity</h3>
                <table>
                    <thead>
                        <tr>
                            <th width="15%">Time (UTC)</th>
                            <th width="5%">Peer ID</th>
                            <th width="5%">Mode</th>
                            <th width="15%">Type</th>
                            <th width="10%">Source</th>
                            <th width="10%">Target</th>
                            <th width="20%">Duration</th>
                            <th width="20%">BER %</th>
                        </tr>
                    </thead>
                    <tbody id="activity"></tbody>
                </table>
            </div>
            <div id="rules"></div>
            <div id="hblink"></div>
        </div>
    </div>
</body>
</html>

<style type="text/css">
<!--
    body,
    font {
        font: 12px verdana, arial, sans-serif;
        color: #fff;
    }

    body {
        background-color: #242d31;
        color: #000000;
    }

    .container {
        width: 95%;
        text-align: left;
        margin: auto;
    }

    .header {
        background-color: #015E7D;
        text-decoration: none;
        color: #fff;
        font-family: verdana, arial, sans-serif;
        text-align: left;
        padding: 5px 0px 22px 0px;
    }

        .header a,
        .header a:link,
        .header a:visited,
        .header a:active {
            color: #fff;
            text-decoration: none;
        }

            .header a:hover {
                text-decoration: underline;
            }

    .menu {
        margin: 0px 10px 0px 0px;
        position: relative;
        float: right;
    }

    .nav {
        float: left;
        margin: 0;
        padding: 3px 3px 3px 3px;
        width: 215px;
        background-color: #242d31;
        font-weight: normal;
        min-height: 100%;
    }

    .content {
        margin: 0 0 0 221px;
        padding: 1px 5px 5px 5px;
        color: #000000;
        background-color: #edf0f5;
        text-align: center;
    }

    .contentwide {
        padding: 5px 5px 5px 5px;
        color: #000000;
        background-color: #edf0f5;
        text-align: center;
    }

    .footer {
        padding: 10px 0 10px 0;
        clear: both;
    }

    table {
        vertical-align: middle;
        text-align: center;
        empty-cells: show;
        padding-left: 0px;
        padding-right: 0px;
        padding-top: 0px;
        padding-bottom: 0px;
        border-collapse: collapse;
        border-color: #242d31;
        border-style: solid;
        border-spacing: 4px;
        border-width: 2px;
        text-decoration: none;
        color: #fff;
        background-color: #242d31;
        font-family: verdana, arial, sans-serif;
        width: 100%;
        white-space: nowrap;
    }

        table thead tr {
            background: linear-gradient(90deg, #4ca6ff, #2192ff);
            color: #f3ffff;
        }

        table th {
            font-family: "Lucidia Console", Monaco, monospace;
            font-weight: normal;
            text-shadow: 1px 1px #01485F;
            text-decoration: none;
            /*background-color: #02759B;*/
            border: 1px solid #01485F;
        }

        table tbody tr:nth-child(even) {
            /*background-color: #f7f7f7;*/
            background: linear-gradient(90deg, #f3ffff, #f7f7f7);
        }

        table tbody tr:nth-child(odd) {
            /*background-color: #d0d0d0;*/
            background: linear-gradient(90deg, #a9a4a4, #d0d0d0);

        }

        table td {
            color: #000000;
            font-family: "Lucidia Console", Monaco, monospace;
            text-decoration: none;
            border: 1px solid #000000;
            overflow-x: hidden;
        }

    a {
        text-decoration: none;
    }

        a:link,
        a:visited {
            text-decoration: none;
            color: #0000e0;
            font-weight: normal;
        }

    ul {
        padding: 5px;
        margin: 10px 0;
        list-style: none;
        float: left;
    }

        ul li {
            float: left;
            display: inline;
            /*For ignore double margin in IE6*/
            margin: 0 10px;
        }

            ul li a {
                text-decoration: none;
                float: left;
                color: #999;
                cursor: pointer;
                font: 900 14px/22px "Arial", Helvetica, sans-serif;
            }

                ul li a span {
                    margin: 0 10px 0 -10px;
                    padding: 1px 8px 5px 18px;
                    position: relative;
                    /*To fix IE6 problem (not displaying)*/
                    float: left;
                }

    h1 {
        text-shadow: 2px 2px #303030;
        text-align: center;
    }

        h1 > a,
        h1 > a:focus,
        h1 > a:active,
        h1 > a:link,
        h1 > a:visited {
            color: #fff;
            text-decoration: none;
        }

        h1 a:hover {
            color: #fff;
            text-decoration: underline;
        }

    ul {
        list-style: none;
        margin: 0;
        padding: 0;
    }

    .span-normal {
        color: #b3bbbb;
    }
    .span-success {
        color: #40dc7f;
    }
    .span-info {
        color: #4ca6ff;
    }
    .span-warning {
        color: #ffae24;
    }
    .span-danger {
        color: #ff386a;
    }

    .table-col-white {
        background-color: #f3ffff !important;
        color: #2a2a2a;
    }

    .table-col-success {
        background-color: #5be190 !important;
    }

    .table-col-info {
        background-color: #0088ff !important;
    }

    .table-col-warn {
        background-color: #ffa100 !important;
    }

    .table-row-danger {
        background: #ff657f !important;
    }

    .table-col-danger {
        background-color: #ff657f !important;
    }

    .table-col-disabled {
        background-color: #666 !important;
        color: #bbb;
    }
-->
</style>
